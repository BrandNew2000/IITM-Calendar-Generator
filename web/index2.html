<!DOCTYPE html>
<html lang="en" class="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Timetable Generator</title>

  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script src="gen_gcal.js"></script>
  <script src="script.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="g_cal_push.js"></script>
  <link rel="stylesheet" media="all" href="style.css">

  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg: #ffffff;
      --text: #222;
      --border: #d0d0d0;
      --card-bg: #fafafa;
      --accent: #4a6fa5;
      --gray-light: #f2f2f2;

      /* Dark mode */
      --bg-dark: #121212;
      --text-dark: #e4e4e4;
      --card-dark: #1e1e1e;
      --border-dark: #333;
    }

    html.light body {
      background: var(--bg);
      color: var(--text);
    }

    html.dark body {
      background: var(--bg-dark);
      color: var(--text-dark);
    }

    body {
      font-family: "Roboto", sans-serif;
      margin: 20px;
      max-width: 100vw;
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
      transition: background 0.3s ease, color 0.3s ease;
    }

    h1, h3 {
      font-weight: 500;
      text-align: center;
    }

    .section-card {
      background: var(--card-bg);
      padding: 15px;
      margin: 20px auto;
      border-radius: 12px;
      max-width: 900px;
      border: 1px solid var(--border);
      transition: background 0.3s ease, border 0.3s ease;
    }

    html.dark .section-card {
      background: var(--card-dark);
      border: 1px solid var(--border-dark);
    }

    button {
      padding: 8px 16px;
      background: var(--accent);
      border: none;
      color: white;
      cursor: pointer;
      border-radius: 6px;
      margin: 5px;
      transition: opacity 0.2s;
    }

    button:hover {
      opacity: 0.8;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      font-variant: small-caps;
      font-size: 0.85rem;
    }

    th, td {
      border: 1px solid var(--border);
      padding: 6px;
      text-align: center;
      transition: background 0.3s ease;
    }

    html.dark th, html.dark td {
      border-color: var(--border-dark);
    }

    .gray_light { background: #e8e8e8; }
    html.dark .gray_light { background: #2a2a2a; }

    /* Responsive table */
    @media (max-width: 900px) {
      table {
        font-size: 0.7rem;
      }
    }

    @media (max-width: 600px) {
      table {
        font-size: 0.55rem;
      }
    }

    @media print {
      .no-print { display: none !important; }
      .only-print { display: block; }
      body { margin: 0; padding: 0; }
      table { width: 100%; }
          
          /* Modernize dynamic tt-data controls without altering HTML */
      .tt-data {
      display: grid;
      gap: 10px;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      padding: 10px;
      background: var(--surface);
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      margin-top: 10px;
      }


      .tt-data select,
      .tt-data input {
      appearance: none;
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid var(--border-color);
      font-size: 0.95rem;
      background: var(--background);
      transition: 0.25s ease;
      width: 100%;
      }


      .tt-data select:hover,
      .tt-data input:hover {
      background: var(--hover);
      }


      .tt-data select:focus,
      .tt-data input:focus {
      outline: none;
      background: var(--surface);
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px var(--accent-color-fade);
      }


      /* Custom select arrow */
      .tt-data select {
      background-image: linear-gradient(45deg, transparent 50%, var(--border-color) 50%),
      linear-gradient(135deg, var(--border-color) 50%, transparent 50%);
      background-position: calc(100% - 18px) calc(50% - 4px), calc(100% - 12px) calc(50% - 4px);
      background-size: 6px 6px;
      background-repeat: no-repeat;
      }


      /* Close button */
      .close-btn {
      font-size: 1.4rem;
      margin-left: 8px;
      cursor: pointer;
      color: var(--danger-color);
      transition: transform 0.2s ease;
      }
      .close-btn:hover {
      transform: scale(1.15);
      }
    
    }
  </style>
</head>

<body>
  <h1 class="no-print">Timetable Generator</h1>
  <h1 class="only-print" style="display:none">Timetable</h1>

  <div class="section-card no-print">
    <h3>Add Slot</h3>
    <p>Add your courses here with the corresponding slot, course number, name and venue.</p>
    <div id="slotInputs"></div>
    <button onclick="addSlotRow()">+ Add Slot</button>
    <button onclick="clearSlotRows()">Clear Slots</button>
  </div>

  <div class="section-card no-print">
    <h3>Manual Override</h3>
    <p>Add an override for a particular day-slot.</p>
    <p><i>Leave fields blank to delete that day-slot.</i></p>
    <div id="overrideInputs"></div>
    <button onclick="addOverrideRow()">+ Add Override</button>
    <button onclick="clearOverrideRows()">Clear Overrides</button>
  </div>

  <div class="section-card no-print">
    <h3>Save / Load</h3>
    <p>You may save your current timetable or load a previously saved one.</p>
    <button onclick="download_data()">Save</button>
    <button onclick="upload_saved_data_file()">Load</button>
    <input id="upload_cal_save" type="file" hidden />
  </div>

  <div class="section-card no-print">
    <h3>Import into your Calendar</h3>
    <p>Download an .ics file or directly import to Google Calendar.</p>
    <button onclick="download_gcal()">Download .ics</button>
    <button onclick="import_gcal()">Import to Google Calendar</button>
  </div>

  <div class="section-card">
    <button class="no-print" onclick="generateTable()">Generate Timetable</button>
    <button class="no-print" onclick="window.print()">Print PDF</button>
    <button class="no-print" onclick="download_tt()">Download Image</button>



      <table class="timetable" id="timetable" style="height: 100%;">
          <tbody>
              <tr class="gray_light">
                  <th>Days</th>
                  <td>8.00 - 8.50</td>
                  <td>9.00 - 9.50</td>
                  <td>10.00 - 10.50</td>
                  <td>11.00 - 11.50</td>
                  <!-- <th rowspan="12" width="50">
                  <p class="font__fontrols__style"><span class="rotate__text">Lunch recess<br>
                  11.50 am - 13.00 pm</span></p>
                  </th> -->
                  <th>Lunch</th>
                  <td>13.00 - 13.50</td>
                  <td>14.00 - 15.15</td>
                  <td>15.30 - 16.45</td>
                  <td>17.00 - 17.50</td>
              </tr>
              <tr>
                  <td class="gray_light" rowspan="2">Mon</td>
                  <td class="lite_green" rowspan="2" id="Monday-A">A</td>
                  <td class="lavender" rowspan="2" id="Monday-B">B</td>
                  <td class="sky" rowspan="2" id="Monday-C">C</td>
                  <td class="orange" rowspan="2" id="Monday-D">D</td>
                  <td class="gray_light" rowspan="2" id="Monday-PG"></td>
                  <td class="mossgreen" rowspan="2" id="Monday-G">G</td>
                  <td class="sandal" colspan="2" id="Monday-P">P</td>
                  <td class="pink" rowspan="2" id="Monday-J">J</td>
              </tr>
              <tr>
                  <td class="green" id="Monday-H">H</td>
                  <td class="lite_blue" id="Monday-M">M</td>
              </tr>
              <tr>
                  <td class="gray_light" rowspan="2">Tue</td>
                  <td class="lavender" rowspan="2" id="Tuesday-B">B</td>
                  <td class="sky" rowspan="2" id="Tuesday-C">C</td>
                  <td class="orange" rowspan="2" id="Tuesday-D">D</td>
                  <td class="red" rowspan="2" id="Tuesday-E">E</td>
                  <td class="gray_light" rowspan="2" id="Tuesday-PG"></td>
                  <td class="lite_green" rowspan="2" id="Tuesday-A">A</td>
                  <td class="sandal" colspan="2" id="Tuesday-Q">Q</td>
                  <td class="yellow" rowspan="2" id="Tuesday-F">F</td>
              </tr>
              <tr>
                  <td class="lite_blue" id="Tuesday-M">M</td>
                  <td class="green" id="Tuesday-H">H</td>
              </tr>
              <tr>
                  <td class="gray_light" rowspan="2">Wed</td>
                  <td class="sky" rowspan="2" id="Wednesday-C">C</td>
                  <td class="orange" rowspan="2"id="Wednesday-D">D</td>
                  <td class="red" rowspan="2" id="Wednesday-E">E</td>
                  <td class="yellow" rowspan="2" id="Wednesday-F">F</td>
                  <td class="gray_light" rowspan="2" id="Wednesday-PG"></td>
                  <td class="lavender" rowspan="2" id="Wednesday-B">B</td>
                  <td class="gray_light" colspan="2" id="Wednesday-R">R</td>
                  <td class="mossgreen" rowspan="2" id="Wednesday-G">G</td>
              </tr>
              <tr>
                  <td class="pink" id="Wednesday-J">J</td>
                  <td class="white_text blue" id="Wednesday-K">K</td>
              </tr>
              <tr>
                  <td class="gray_light" rowspan="2">Thu</td>
                  <td class="red" rowspan="2" id="Thursday-E">E</td>
                  <td class="yellow" rowspan="2" id="Thursday-F">F</td>
                  <td class="mossgreen" rowspan="2" id="Thursday-G">G</td>
                  <td class="lite_green" rowspan="2" id="Thursday-A">A</td>
                  <td class="gray_light" rowspan="2" id="Thursday-PG"></td>
                  <td class="orange" rowspan="2" id="Thursday-D">D</td>
                  <td class="sandal" colspan="2"id="Thursday-S">S</td>
                  <td class="green" rowspan="2" id="Thursday-H">H</td>
              </tr>
              <tr>
                  <td class="gray white_text" id="Thursday-L">L</td>
                  <td class="pink" id="Thursday-J">J</td>
              </tr>
              <tr>
                  <td class="gray_light" rowspan="2">Fri</td>
                  <td class="yellow" rowspan="2" id="Friday-F">F</td>
                  <td class="mossgreen" rowspan="2" id="Friday-G">G</td>
                  <td class="lite_green" rowspan="2" id="Friday-A">A</td>
                  <td class="lavender" rowspan="2" id="Friday-B">B</td>
                  <td class="gray_light" rowspan="2" id="Friday-PG"></td>
                  <td class="sky" rowspan="2" id="Friday-C">C</td>
                  <td class="sandal" colspan="2" id="Friday-T">T</td>
                  <td class="red" rowspan="2" id="Friday-E">E</td>
              </tr>
              <tr>
                  <td class="blue white_text"id="Friday-K">K</td>
                  <td class="gray white_text" id="Friday-L">L</td>
              </tr>
          </tbody>
      </table>
  </div>

  <footer class="no-print" style="text-align:center; margin-top:40px; opacity:0.7;">
    <p>Contact: <a href="mailto:ar@smail.iitm.ac.in">ar@smail.iitm.ac.in</a></p>
    <p><b><i>Designed by Achintya Raghavan</i></b></p>
  </footer>

  <script>
    // Simple dark/light toggle
    const toggleMode = () => {
      document.documentElement.classList.toggle('dark');
      document.documentElement.classList.toggle('light');
    };
  </script>
</body>
</html>
